<%include common\header.html%>
	<body ng-controller="homeController" class="home-body">
		<div class="cf mt20">
			<a href="/home/toAdd" class="btn btn-default fr">新增接口</a>
		</div>
		<table class="table table-striped table-bordered table-hover table-condensed mt20">
			<thead>
				<tr>
					<th class="col-sm-3">名称</th>
					<th class="col-sm-5">描述</th>
					<th class="col-sm-1">创建人</th>
					<th class="col-sm-1">创建时间</th>
					<th class="col-sm-1">更新时间</th>
					<th class="text-center col-sm-1">操作</th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat="interFace in interFaceList">
					<td>{{interFace.name}}</td>
					<td>{{interFace.description}}</td>
					<td>{{interFace.createBy}}</td>
					<td>{{interFace.createTime | date:"yyyy-MM-dd HH:mm"}}</td>
					<td>{{interFace.updateTime | date:"yyyy-MM-dd HH:mm"}}</td>
					<td class="text-center">
						<a href="javascript:void(0);" ng-click="deleteItem(interFace)">删除</a>
						<a href="/home/toUpdate?id={{interFace._id}}">编辑</a>
						<a href="/home/toView?id={{interFace._id}}">查看</a>
					</td>
				</tr>
			</tbody>
		</table>
	</body>
	<%include common\footer.html%>
	<script type="text/javascript">
		angular.element(document).ready(function() {
			"use strict"
			var homeCtrl = function($scope, homeService) {
				homeService.getInterfaceList().then(function(data) {
					$scope.interFaceList = data;
				});

				$scope.deleteItem = function(item) {
					var res = window.confirm("你确定要删除吗？");
					if(res) {
						homeService.delInterface(item).then(function(data) {
							$scope.interFaceList.splice($scope.interFaceList.indexOf(item), 1);
						});
					}
				};
			};

			var interfaceHome = angular.module("interface.home", []);
			interfaceHome.controller("homeController", ["$scope", "homeService", homeCtrl]);
			interfaceHome.service("homeService", ["$http", "$q", function($http, $q) {
				var baseUrl = "/home";
				this.getInterfaceList = function(options) {
					var opt = "";
					for(var key in options) {
						if(0<opt.length) {
							opt += "&";
						} else {
							opt = "?" + opt;
						}
						key += opt;
					}
					var deferred = $q.defer();
					$http({
						method: "GET",
						url: baseUrl + "/search" + opt
					}).success(function(data) {
						deferred.resolve(data);
					}).error(function() {
						deferred.reject("There was an error");
					});
					return deferred.promise;
				};

				this.delInterface = function(data) {
					if(!data) return ;
					var deferred = $q.defer();
					$http({
						method: "POST",
						url: baseUrl + "/delete",
						data: data
					}).success(function(data) {
						deferred.resolve(data);
					}).error(function() {
						deferred.reject("There was an error");
					});
					return deferred.promise;
				};
			}]);
			
			angular.bootstrap(document, ['interface.home']);
		});
	</script>
</html>