<%include common\header.html%>
	<body ng-controller="homeController" class="home-body">
		<!-- <div>
			<ul>
				<li class="form-group">
					<label for="title" class="control-label col-sm-2">名称：</label>
					<div class="col-sm-10">
						<input class="form-control" type="text" required name="title" id="title" ng-model="interface.title">
					</div>
				</li>
				<li></li>
				<li></li>
				<li></li>
			</ul>
		</div> -->
		<div class="cf mt20">
			<a href="/home/toAdd" class="btn btn-default fr">新增接口</a>
		</div>
		<table class="table table-striped table-bordered table-hover table-condensed mt20">
			<thead>
				<tr>
					<th class="col-sm-2">名称</th>
					<th class="col-sm-1">类型</th>
					<th class="col-sm-5">描述</th>
					<th class="col-sm-1">创建人</th>
					<th class="col-sm-1">创建时间</th>
					<th class="col-sm-1">更新时间</th>
					<th class="text-center col-sm-1">操作</th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat="interFace in interFaceList">
					<td>{{interFace.title}}</td>
					<td>{{interFace.type | type}}</td>
					<td>{{interFace.description}}</td>
					<td>{{interFace.createBy}}</td>
					<td>{{interFace.createTime | date:"yyyy-MM-dd HH:mm"}}</td>
					<td>{{interFace.updateTime | date:"yyyy-MM-dd HH:mm"}}</td>
					<td class="text-center">
						<a href="javascript:void(0);" ng-click="deleteItem(interFace)">删除</a>
						<a href="/home/toUpdate?id={{interFace._id}}">编辑</a>
						<a href="/home/toView?id={{interFace._id}}">查看</a>
					</td>
				</tr>
			</tbody>
		</table>
		<nav>
			<ul class="pagination">
				<li>
					<a href="javascript:void(0);" aria-label="Previous" ng-click="go(options.currentPage-1)">
						<span aria-hidden="true">&laquo;</span>
					</a>
				</li>
				<li ng-repeat="pageObj in pageNumbers" ng-class="{active:pageObj.isActive}">
					<a href="javascript:void(0);" ng-click="go(pageObj.number)">{{pageObj.number}}</a>
				</li>
				<li>
					<a href="javascript:void(0);" aria-label="Next" ng-click="go(options.currentPage+1)">
						<span aria-hidden="true">&raquo;</span>
					</a>
				</li>
			</ul>
		</nav>
	</body>
	<%include common\footer.html%>
	<script type="text/javascript">
		angular.element(document).ready(function() {
			"use strict"
			var homeCtrl = function($scope, homeService) {
				$scope.options = {};
				$scope.options.pageSize = 10;
				$scope.options.currentPage = 1;
				$scope.totalPage = 0;

				var getInterFaceList = function() {
					homeService.getInterfaceList($scope.options).then(function(data) {
						$scope.interFaceList = data.interFace;
						$scope.pageNumbers = [];
						$scope.totalPage = data.totalPage;
						var start = data.currentPage-2<1?1:data.currentPage-2;
						var end = start+4>data.totalPage?data.totalPage:start+4;
						do {
							var pageObj = {
								number: start,
								isActive: start===$scope.options.currentPage?true:false
							};
							$scope.pageNumbers.push(pageObj);
							start++;
						} while(start<=end)
					});
				};

				$scope.go = function(number) {
					number = number<1?1:(number>$scope.totalPage?$scope.totalPage:number);
					$scope.options.currentPage = number;
					getInterFaceList();
				};

				$scope.deleteItem = function(item) {
					var res = window.confirm("你确定要删除吗？");
					if(res) {
						homeService.delInterface(item).then(function(data) {
							$scope.interFaceList.splice($scope.interFaceList.indexOf(item), 1);
						});
					}
				};

				getInterFaceList();
			};

			var interfaceHome = angular.module("interface.home", []);
			interfaceHome.controller("homeController", ["$scope", "homeService", homeCtrl]);
			interfaceHome.filter("type", function() {
				return function(input) {
					var typeList = ["前端", "后端", "插件", "移动"];
					return typeList[input-1];
				};
			});
			interfaceHome.service("homeService", ["$http", "$q", function($http, $q) {
				var baseUrl = "/home";
				this.getInterfaceList = function(options) {
					var deferred = $q.defer();
					$http({
						method: "POST",
						url: baseUrl + "/search",
						data: options
					}).success(function(data) {
						deferred.resolve(data);
					}).error(function() {
						deferred.reject("There was an error");
					});
					return deferred.promise;
				};

				this.delInterface = function(data) {
					if(!data) return ;
					var deferred = $q.defer();
					$http({
						method: "POST",
						url: baseUrl + "/delete",
						data: data
					}).success(function(data) {
						deferred.resolve(data);
					}).error(function() {
						deferred.reject("There was an error");
					});
					return deferred.promise;
				};
			}]);

			angular.bootstrap(document, ['interface.home']);
		});
	</script>
</html>